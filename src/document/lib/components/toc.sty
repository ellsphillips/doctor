\renewcommand\chaptermark[1]{\markboth{\textcolor{white}{#1}}{}}

% Avoid badbox for >100 page documents
\renewcommand{\@pnumwidth}{3em}%
\contentsmargin{-0mm}%

\dottedcontents{section}[2.3em]{}{2.3em}{5pt}
\dottedcontents{subsection}[5.5em]{}{3.2em}{5pt}

% Start title contents formatting
%
% TOC Chapter
%
	\titlecontents{chapter}[3.3pc]
	{%
		\addvspace{30pt}%
%		\stepcounter{charpitre}
		\begin{tikzpicture}[remember picture, overlay]%
			\fill[
				rounded corners = 4pt,
				inner sep = 11pt,
				clr-accent,
				text=white
			] (-4.5,-.2) rectangle (-.8,.6);%
		%
			\node at (-2.5,0.2) {%
				\hyperlink{chapter\thechapter}{%
					\XeTeXLinkBox{\phantom{\rule{3.4cm}{.6cm}}}
				}
			};
			\node[xshift=-2.5cm, yshift=0.2cm]{%
				\raggedright\bfseries\color{white}\large\sc%
				Chapter\ \thecontentslabel%
			};%
		\end{tikzpicture}%
		\large\bfseries\color{black}}%
	{}
	{}
	{%
		\;\titlerule\;\large\bfseries Page\ \thecontentspage%
		\begin{tikzpicture}[remember picture, overlay]
			\draw[black] (2pt,0) rectangle (6,0.1pt);
		\end{tikzpicture}%
	}%
	[\addvspace{.2cm}]%
%
% TOC Section
%
	\titlecontents{section}[3.3pc]
	{\addvspace{5pt}}
	{%
		\color{black}\contentslabel[\thecontentslabel]{2pc}\color{black}}
	{}
	{\mdseries\titlerule*[0.75em]{$\cdotp$}\bfseries
		\small\color{black}\thecontentspage\color{black}}
	[\addvspace{3pt}]
%
% TOC Subsection
%
	\titlecontents{subsection}[5.1pc]
	{\addvspace{5pt}}
	{%
		\contentslabel[\thecontentslabel]{2pc}}
	{\color{black!50}}
	{\hfill\small\color{black!50}\thecontentspage}
	[\addvspace{0pt}]
%
% TOC Figure
%
	\titlecontents{figure}
	[0em]
	{}
	{\fbox{\thecontentslabel}\hspace*{1.5em}}
	{}
	{\ \titlerule*[8pt]{$\cdot$}\contentspage}
%
% End title contents formatting

% Correct spacing between page header and TOC
\renewcommand{\tableofcontents}{%
	\chapter*{\contentsname}%
	\markboth{\contentsname}{}
%	\def\@leftmark{\contentsname}%
	\vspace{-30pt}%
	\@starttoc{toc}
}
